# Maintainer: danyf90 <daniele.formichelli@gmail.com>
# Contributor: Andrea Cattaneo <andrea.cattaneo.dev@gmail.com>

pkgname=genymotion
pkgver=2.2.2
pkgrel=3
pkgdesc="Complete set of tools that provides a virtual environment for Android."
arch=('i686' 'x86_64')
license="UNKNOWN"
url="http://www.genymotion.com/"
depends=('virtualbox' 'qtwebkit' 'libpng12' 'net-tools' 'qca' 'ffmpeg-compat' 'protobuf')
install=$pkgname.install
sha512sums=('48e9bafe1d64b688c51eceb8d129f44d690060ff9a6d82eefcf3295f7834516ce62439faf4f4454287f594fc410aafbafd30a43537ea3d295c42bee8e4e03ac7')
if [[ $CARCH == x86_64 ]]; then
  _ARCH="x64"
  sha512sums+=('0d05da1e5b2bf188d7ce034c60874c207bd7cfeef391c51bc69f0244b6383b93278a229742f669812c7c2dc4c7a12a06eb47558b0b8c7d682e302b7828e94401')
else
  _ARCH="x86"
  sha512sums+=('60e73f871f148a7722ff198e8ac65abf9c804947e6dcf6f5fb840d8d2f311ccdab8139d991a2c9d61570275dfcebe3d6c255adf55795f474a60c541e2f5f5243')
fi
source=("genymotion.desktop"
        "$pkgname.bin::http://files2.genymotion.com/genymotion/genymotion-$pkgver/genymotion-${pkgver}_$_ARCH.bin")

package(){
  cd $srcdir

  install -d $pkgdir/opt
  chmod +x $pkgname.bin
  yes | ./$pkgname.bin -d $pkgdir/opt
  rm $pkgdir/opt/genymotion/libQt*

  install -d $pkgdir/usr/bin
  ln -s /opt/genymotion/genymotion $pkgdir/usr/bin/genymotion
  ln -s /opt/genymotion/genymotion-shell $pkgdir/usr/bin/genymotion-shell
  ln -s /opt/genymotion/player $pkgdir/usr/bin/player
  install -Dm644 $srcdir/genymotion.desktop $pkgdir/usr/share/applications/genymotion.desktop
  chown -R root:root $pkgdir/opt/genymotion
}