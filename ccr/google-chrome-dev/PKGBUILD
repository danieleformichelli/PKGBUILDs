# Mantainer:   danyf90 <daniele.formichelli@gmail.com>
# Contributor: Anke Boersma <abveritas@chakra-project.org>

pkgname=google-chrome-dev
pkgver=51.0.2679.0
pkgrel=1
pkgdesc="Google Chrome Developer preview channel for Linux"
arch=('x86_64')
url="http://www.google.com/chrome"
license=('custom:chrome')
depends=('alsa-lib' 'gconf' 'gtk2' 'hicolor-icon-theme' 'libpng' 'libxslt' 'libxss' 'nss' 'xdg-utils')
provides=("google-chrome=$pkgver")
options=(!strip)
install=$pkgname.install
_channel=unstable

package() {
  msg "Downloading Google Chrome .deb"
  wget -Nc "https://dl.google.com/linux/direct/google-chrome-${_channel}_current_amd64.deb"
  msg2 "Done downloading!"

  msg "Extracting"
  ar -xv $srcdir/google-chrome-${_channel}_current_amd64.deb
  tar -xvf $srcdir/data.tar.xz
  msg2 "Done extracting!"

  msg "Installing"
  install -d $pkgdir/{usr/{bin,lib},opt/google}
  cp -r $srcdir/opt/google/chrome-$_channel $pkgdir/opt/google/

  install -D $srcdir/usr/share/applications/google-chrome-$_channel.desktop $pkgdir/usr/share/applications/google-chrome-$_channel.desktop
  ln -s /opt/google/chrome-$_channel/google-chrome-$_channel $pkgdir/usr/bin/google-chrome-$_channel

  gzip -9 $srcdir/usr/share/man/man1/google-chrome-$_channel.1
  install -Dm644 $srcdir/usr/share/man/man1/google-chrome-$_channel.1.gz $pkgdir/usr/share/man/man1/google-chrome-$_channel.1.gz

  # Symlinking icons to /usr/share/icons/hicolor/
  for i in 16x16 22x22 24x24 32x32 48x48 64x64 128x128 256x256; do
    mkdir -p $pkgdir/usr/share/icons/hicolor/$i/apps/
    ln -s /opt/google/chrome-$_channel/product_logo_${i/x*}.png $pkgdir/usr/share/icons/hicolor/$i/apps/google-chrome-$_channel.png
  done

  # Fixing permissions of chrome-sandbox
  chmod 4755 $pkgdir/opt/google/chrome-$_channel/chrome-sandbox
}
