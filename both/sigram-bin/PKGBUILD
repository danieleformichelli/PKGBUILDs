# Maintainer:  danyf90 <daniele.formihelli@gmail.com>
# Contributor: totoloco <totoloco@gmx.com>

pkgname=sigram-bin
_pkgname=sigram
pkgver=0.7.0
pkgrel=1
pkgdesc="A different telegram client from Sialan.labs"
arch=('i686' 'x86_64')
url="http://labs.sialan.org/projects/sigram"
license=('GPL')
depends=('qt5-base' 'qt5-declarative')
if [[ $CARCH == x86_64 ]]; then
  filename=${_pkgname}-$pkgver-linux-x64-installer.run
  source=("http://dl.labs.sialan.org/$filename")
  sha512sums=('9c2b64d2772e180122c4c608b06f78aeb9a6516b99a53eca9a736e67f633a6014c9df3bf163ddc86323bc2c9bc78cec04ffb3fc1cb5a73abb3886afdd0dbacfc')
else
  filename=${_pkgname}-$pkgver-linux-installer.run
  source=("http://dl.labs.sialan.org/$filename")
  sha512sums=('a108d6d3eb05485ddfb19601080bde37ba27be6d421384bb0cf7fb62ff7fdff8e9ccf23cf819cfce9d518312d2c45e102787f01d1d57882e361d745b60ac356a')
fi

source+=("$_pkgname.desktop")
sha512sums+=('364a3cfd82f8e12ba7117f67c2d3ab6bf32bb8a16f997742b1a5955263536095aeac59e19f3161bf266228d9b164dafbb7a30c9dc7221bdb89dbefa96b43a519')

package() {
  cd $srcdir

  install -d $pkgdir/{opt,usr/bin}

  chmod a+x $filename

  ./$filename --prefix $pkgdir/opt --mode unattended

  rm $pkgdir/opt/uninstall
  rm $pkgdir/opt/Uninstall\ Sigram.desktop
  rm $pkgdir/opt/uninstall.dat

  install -Dm644 $srcdir/$_pkgname.desktop $pkgdir/usr/share/applications/$_pkgname.desktop


  # fix undefined symbol: EVP_idea_cbc error
  ln -sf /usr/lib/libcrypto.so.1.0.0 $pkgdir/opt/$_pkgname/libs/libcrypto.so.1.0.0
}